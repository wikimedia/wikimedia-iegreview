{% extends 'reports/base.html' %}

{% block subtitle %}{{ 'nav-reports-wikitext'|message }}{% endblock %}

{% block content %}
{% spaceless %}
<ol class="breadcrumb">
  <li><a href="{{ urlFor( 'campaigns' ) }}">{{ 'nav-campaigns'|message }}</a></li>
  <li>{{ 'nav-reports'|message }}</li>
  <li><a href="{{ urlFor( 'reports_wikitext', { 'campaign':campaign } ) }}">{{ 'nav-reports-wikitext'|message }}</a></li>
</ol>

<form class="form-inline" method="get" action="{{ urlFor( 'reports_wikitext', { 'campaign':campaign } ) }}" role="form">
  <div class="form-group">
    <label class="sr-only" for="th">{{ 'proposals-queue-theme'|message }}</label>
    <select id="th" name="th" class="form-control">
      <option value="">{{ 'proposals-queue-theme-empty'|message }}</option>
      {% for val in [ 'online', 'offline', 'tool', 'research' ] %}
      <option value="{{ val }}" {{ val == th ? 'selected="selected"' }}>{{ "theme-#{val}"|message }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="form-group">
    <button type="submit" class="btn btn-sm btn-primary">
      <i class="glyphicon glyphicon-filter"></i>
      {{ 'reports-wikitext-go'|message }}
    </button>
  </div>
</form>

<p></p>
<div class="panel-group" id="accordion">
  {% for row in report.rows %}
  <div class="panel panel-default">
    <div class="panel-heading">
      <h4 class="panel-title">
        <a class="accordion-toggle collapsed block" data-toggle="collapse" data-parent="#accordion" href="#proposal{{ row.id }}">
          {{ row.title }}
          ·
          <small>{{ "theme-#{row.theme}"|message }}</small>
          ·
          <small>
            {{ row.pcnt|number_format(2) }}%
            ({{ row.recommend }}/{{ row.rcnt }}){{ row.conditional }}
          </small>
        </a>
      </h4>
    </div>
    <div id="proposal{{ row.id }}" class="panel-collapse collapse">
      <div class="panel-body form-group">
        <a href="{{ row.url|raw }}" target="_blank">{{ row.title }}</a>
        <textarea class="form-control" rows="10" readonly>
==Aggregated feedback from the committee for ''{{ row.title }}''==
{{ '{{' }}Inspire/Review/Score
{% for label, qid in questions %}
| {{ label }} score={{ row[qid]|number_format(1) }}
{% endfor %}
| comments=
{% for comment in row.comments %}
* {{ comment|replace( { "\n":' ' } ) }}
{% endfor %}
{{ '}}' }}
</textarea>
      </div>
    </div>
  </div>
  {% endfor %}
</div>

{% endspaceless %}
{% endblock content %}
